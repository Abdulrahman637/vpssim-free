#!/bin/bash
. /home/vpssim.conf

#
cd ~
cd /tmp
rm -rf 00-all-nginx-version.txt
wget --no-check-certificate -q https://raw.githubusercontent.com/itvn9online/vpssim-free/master/script/vpssim/00-all-nginx-version.txt

cd ~
mkdir -p /opt/echbay_vpssim/script/vpssim
cd /opt/echbay_vpssim/script/vpssim
rm -rf nginx-setup.conf
wget --no-check-certificate -q https://github.com/itvn9online/vpssim-free/raw/master/script/vpssim/nginx-setup.conf


cd ~
mkdir -p /opt/echbay_vpssim/script/vpssim/menu
cd /opt/echbay_vpssim/script/vpssim/menu
if [ "$(rpm -q --qf "%{VERSION}" $(rpm -q --whatprovides redhat-release))" == "6" ]; then
rm -rf nginx-setup6
wget --no-check-certificate -q https://github.com/itvn9online/vpssim-free/raw/master/script/vpssim/menu/nginx-setup6
chmod +x nginx-setup6
/opt/echbay_vpssim/script/vpssim/menu/nginx-setup6
else
rm -rf nginx-setup7
wget --no-check-certificate -q https://github.com/itvn9online/vpssim-free/raw/master/script/vpssim/menu/nginx-setup7
chmod +x nginx-setup7
/opt/echbay_vpssim/script/vpssim/menu/nginx-setup7
fi

cd ~

check_spdy_http2 () {
if [ ! "$(grep spdy /etc/nginx/conf.d/*.conf)" == "" ]; then 
sed -i 's/spdy/http2/g' /etc/nginx/conf.d/*.conf
fi
}
check_spdy_http2

if [ "$(rpm -q --qf "%{VERSION}" $(rpm -q --whatprovides redhat-release))" == "7" ]; then 
systemctl restart nginx.service
else
service nginx restart
fi
clear
echo "========================================================================="
echo "Cai dat Nginx phien ban $Nginx_VERSION thanh cong !"
/etc/vpssim/menu/vpssim-update-upgrade-service-menu

